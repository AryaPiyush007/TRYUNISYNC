<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UniSync - College Platform</title>

  <!-- React + Babel + Tailwind -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      margin: 0;
      padding: 0;
      background-image: url('./NEUMORPHIC_CIRCLES_BACKGROUND.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      width: 100%;
    }

    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Custom Gradientss */
    .card-gradient-blue { background: linear-gradient(145deg, #3B82F6 0%, #06B6D4 100%); }
    .card-gradient-green { background: linear-gradient(145deg, #10B981 0%, #34D399 100%); }
    .card-gradient-purple { background: linear-gradient(145deg, #8B5CF6 0%, #EC4899 100%); }
    .card-gradient-indigo { background: linear-gradient(145deg, #6366F1 0%, #3B82F6 100%); }
    .card-gradient-orange { background: linear-gradient(145deg, #F59E0B 0%, #FDE047 100%); }
    .card-gradient-rose { background: linear-gradient(145deg, #F43F5E 0%, #EC4899 100%); }
    .card-gradient-violet { background: linear-gradient(145deg, #8B5CF6 0%, #A855F7 100%); }

    /* === Premium Glassy Look === */

    /* Main glass container */

    /* Feature cards with frosted glass effect */
    .feature-card {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(18px) saturate(180%);
      -webkit-backdrop-filter: blur(18px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.25);
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease-in-out;
    }

    .feature-card:hover {
      transform: translateY(-6px) scale(1.03);
      background: rgba(255, 255, 255, 0.25);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.35), 0 0 25px rgba(140, 82, 255, 0.4);
      border-color: rgba(255, 255, 255, 0.4);
    }

  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // API Configuration
    const API_BASE_URL = 'http://localhost:3000/api';

    // Authentication Context
    const AuthContext = React.createContext();

    const useAuth = () => {
      const [user, setUser] = useState(null);
      const [token, setToken] = useState(localStorage.getItem('token'));
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        if (token) {
          fetchUserProfile();
        } else {
          setLoading(false);
        }
      }, [token]);

      const fetchUserProfile = async () => {
        try {
          const response = await fetch(`${API_BASE_URL}/auth/profile`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });

          if (response.ok) {
            const data = await response.json();
            setUser(data.data.user);
          } else {
            logout();
          }
        } catch (error) {
          console.error('Failed to fetch profile:', error);
          logout();
        } finally {
          setLoading(false);
        }
      };

      const login = async (email, password) => {
        try {
          const response = await fetch(`${API_BASE_URL}/auth/login`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email, password })
          });

          if (response.ok) {
            const data = await response.json();
            localStorage.setItem('token', data.data.token);
            setToken(data.data.token);
            setUser(data.data.user);
            return { success: true };
          } else {
            const error = await response.json();
            return { success: false, error: error.error };
          }
        } catch (error) {
          return { success: false, error: 'Login failed' };
        }
      };

      const register = async (userData) => {
        try {
          const response = await fetch(`${API_BASE_URL}/auth/register`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(userData)
          });

          if (response.ok) {
            const data = await response.json();
            localStorage.setItem('token', data.data.token);
            setToken(data.data.token);
            setUser(data.data.user);
            return { success: true };
          } else {
            const error = await response.json();
            return { success: false, error: error.error };
          }
        } catch (error) {
          return { success: false, error: 'Registration failed' };
        }
      };

      const logout = () => {
        localStorage.removeItem('token');
        setToken(null);
        setUser(null);
      };

      return { user, token, loading, login, register, logout };
    };

    // Login Modal Component
    const LoginModal = ({ isOpen, onClose, onAuthSuccess }) => {
      const [isLogin, setIsLogin] = useState(true);
      const [formData, setFormData] = useState({
        email: '',
        password: '',
        username: '',
        college: '',
        year: '',
        branch: ''
      });
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');
      const { login, register } = useAuth();

      const handleSubmit = async (e) => {
        e.preventDefault();
        setLoading(true);
        setError('');

        try {
          let result;
          if (isLogin) {
            result = await login(formData.email, formData.password);
          } else {
            result = await register({
              ...formData,
              year: formData.year ? parseInt(formData.year) : undefined
            });
          }

          if (result.success) {
            onAuthSuccess();
            onClose();
          } else {
            setError(result.error);
          }
        } catch (error) {
          setError('An error occurred');
        } finally {
          setLoading(false);
        }
      };

      if (!isOpen) return null;

      return (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
          <div className="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
            <h2 className="text-2xl font-bold mb-6 text-gray-800">
              {isLogin ? 'Welcome Back' : 'Create Account'}
            </h2>

            {error && (
              <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                {error}
              </div>
            )}

            <form onSubmit={handleSubmit}>
              {!isLogin && (
                <input
                  type="text"
                  placeholder="Username"
                  value={formData.username}
                  onChange={(e) => setFormData({...formData, username: e.target.value})}
                  className="w-full p-3 border rounded-lg mb-4"
                  required
                />
              )}

              <input
                type="email"
                placeholder="Email"
                value={formData.email}
                onChange={(e) => setFormData({...formData, email: e.target.value})}
                className="w-full p-3 border rounded-lg mb-4"
                required
              />

              <input
                type="password"
                placeholder="Password"
                value={formData.password}
                onChange={(e) => setFormData({...formData, password: e.target.value})}
                className="w-full p-3 border rounded-lg mb-4"
                required
              />

              {!isLogin && (
                <>
                  <input
                    type="text"
                    placeholder="College"
                    value={formData.college}
                    onChange={(e) => setFormData({...formData, college: e.target.value})}
                    className="w-full p-3 border rounded-lg mb-4"
                  />

                  <div className="grid grid-cols-2 gap-4 mb-4">
                    <input
                      type="number"
                      placeholder="Year"
                      value={formData.year}
                      onChange={(e) => setFormData({...formData, year: e.target.value})}
                      className="p-3 border rounded-lg"
                      min="1"
                      max="4"
                    />
                    <input
                      type="text"
                      placeholder="Branch"
                      value={formData.branch}
                      onChange={(e) => setFormData({...formData, branch: e.target.value})}
                      className="p-3 border rounded-lg"
                    />
                  </div>
                </>
              )}

              <button
                type="submit"
                disabled={loading}
                className="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:opacity-90 transition disabled:opacity-50"
              >
                {loading ? 'Loading...' : (isLogin ? 'Login' : 'Sign Up')}
              </button>
            </form>

            <div className="mt-4 text-center">
              <button
                onClick={() => setIsLogin(!isLogin)}
                className="text-blue-600 hover:underline"
              >
                {isLogin ? "Don't have an account? Sign up" : "Already have an account? Login"}
              </button>
            </div>

            <button
              onClick={onClose}
              className="absolute top-4 right-4 text-gray-500 hover:text-gray-700"
            >
              âœ•
            </button>
          </div>
        </div>
      );
    };

    const FeatureCard = ({ id, label, icon, url, onClick }) => (
      <a
        href={url}
        className="feature-card block p-6 rounded-2xl text-white cursor-pointer transition-transform duration-300 hover:scale-[1.02]"
        onClick={(e) => {
          e.preventDefault();
          onClick(id, url);
        }}
      >
        <div className="flex items-center space-x-4">
          <div className="text-4xl p-3 bg-white/20 backdrop-blur-sm rounded-lg">
            {icon}
          </div>
          <h2 className="text-xl font-semibold tracking-wide">{label}</h2>
        </div>
      </a>
    );

    const UniSync = () => {
      const { user, logout } = useAuth();
      const [clickedId, setClickedId] = useState(null);
      const [showLoginModal, setShowLoginModal] = useState(false);

      const features = [
        { id: 'notes', label: 'Notes Sharing', icon: 'ðŸ“', url: 'notes.html' },
        { id: 'groups', label: 'Study Groups', icon: 'ðŸ‘¥', url: 'groups.html' },
        { id: 'events', label: 'University Events', icon: 'ðŸ“…', url: 'events.html' },
        { id: 'messages', label: 'Messages / Chat', icon: 'ðŸ’Œ', url: 'messages.html' },
        { id: 'marketplace', label: 'Marketplace', icon: 'ðŸ›’', url: 'marketplace.html' },
        { id: 'forum', label: 'Q&A Forum', icon: 'ðŸ’¬', url: 'forum.html' },
        { id: 'dashboard', label: 'Personal Dashboard', icon: 'ðŸ“Š', url: 'dashboard.html' }
      ];

      const handleCardClick = (id, url) => {
        setClickedId(id);
        setTimeout(() => {
          window.location.href = url;
        }, 300);
      };

      const handleAuthSuccess = () => {
        // User is now authenticated, reload page to update state
        window.location.reload();
      };

      return (
        <div className="min-h-screen bg-black/40 backdrop-blur-sm">
          {/* Header */}
          <header className="backdrop-blur-lg bg-gradient-to-r from-gray-900/70 via-gray-800/50 to-gray-900/70 shadow-lg sticky top-0 z-50 border-b border-white/10 bg-[length:200%_200%] animate-[gradientMove_8s_ease_infinite]">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <div className="flex justify-between items-center h-20">
                <a href="#" className="flex items-center gap-3">
                  <div className="w-14 h-14 bg-gradient-to-tr from-indigo-500 via-blue-500 to-cyan-400 rounded-2xl flex items-center justify-center text-white font-extrabold text-3xl shadow-[4px_4px_10px_rgba(0,0,0,0.3)] hover:translate-y-1 transition-transform">
                    U
                  </div>
                  <h1 className="text-3xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 via-purple-400 to-indigo-400 drop-shadow-[0_0_6px_rgba(138,43,226,0.4)]">
                    UniSync
                  </h1>
                </a>
                <div className="flex items-center space-x-4">
                  <button className="text-gray-300 hover:text-purple-400 transition duration-150 p-2 rounded-full hover:bg-gray-700/30" aria-label="Notifications">
                    <span className="text-2xl">ðŸ””</span>
                  </button>

                  {user ? (
                    <>
                      <button
                        className="text-gray-300 hover:text-white transition duration-150 text-sm"
                        title={user.email}
                      >
                        {user.username}
                      </button>
                      <button
                        className="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold flex items-center justify-center hover:opacity-90 transition duration-150"
                        title={user.username}
                        aria-label="User Profile"
                      >
                        {user.username.charAt(0).toUpperCase()}
                      </button>
                      <button
                        onClick={logout}
                        className="text-gray-300 hover:text-red-400 transition duration-150 p-2 rounded-full hover:bg-gray-700/30"
                        title="Logout"
                      >
                        ðŸšª
                      </button>
                    </>
                  ) : (
                    <button
                      onClick={() => setShowLoginModal(true)}
                      className="w-10 h-10 rounded-full bg-gray-200 text-gray-700 font-semibold flex items-center justify-center hover:bg-gray-300 transition duration-150"
                      aria-label="Login"
                    >
                      ðŸ‘¤
                    </button>
                  )}
                </div>
              </div>
            </div>
          </header>

          {/* Main Content */}
          <main className="main-container py-16 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto text-center">
            <h1 className="text-5xl font-extrabold text-white mb-3 drop-shadow-md">
              Your Synchronized University Experience
            </h1>
            <p className="text-xl text-white mb-10">
              {user ? `Welcome back, ${user.username}!` : 'Choose your adventure and connect with your college community.'}
            </p>

            {/* Features Grid */}
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
              {features.map(feature => (
                <FeatureCard key={feature.id} {...feature} onClick={handleCardClick} />
              ))}
            </div>

            {/* Embedded Slow Roads */}
            <div className="mt-20 text-center">
              <h2 className="text-3xl font-bold mb-4 text-white">
                Take a Break !!! Play Slow Roads ðŸš—
              </h2>
              <p className="text-white mb-6">
                Relax and drive through stunning landscapes, right here in your UniSync dashboard.
              </p>

              <div className="w-full rounded-2xl overflow-hidden shadow-2xl border-4 border-purple-300">
                <iframe
                  src="https://slowroads.io/"
                  width="100%"
                  height="600"
                  allow="fullscreen"
                  tabindex="-1"
                  className="w-full"
                ></iframe>
              </div>
            </div>
          </main>

          {/* Login Modal */}
          <LoginModal
            isOpen={showLoginModal}
            onClose={() => setShowLoginModal(false)}
            onAuthSuccess={handleAuthSuccess}
          />
        </div>
      );
    };

    ReactDOM.render(<UniSync />, document.getElementById("root"));
  </script>
  <script>
  // Prevent iframe auto-focus scroll on load
  window.addEventListener('load', () => {
    setTimeout(() => {
      window.scrollTo(0, 0);
    }, 0); // small delay ensures iframe has loaded
  });
</script>

</body>
</html>
